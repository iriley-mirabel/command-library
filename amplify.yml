version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Debug: Show current directory structure
        - echo "Current directory:"
        - pwd
        - echo "Directory contents:"
        - ls -la
        # Copy command files to web portal public directory (excluding archive)
        - echo "Copying command files to web portal..."
        - mkdir -p app/web-portal/public/commands
        - find .cursor/commands -maxdepth 1 -name "*.md" -not -name "README.md" -exec cp {} app/web-portal/public/commands/ \; || true
        - cp library/commands-index.json app/web-portal/public/commands/index.json || true
        - echo "Verifying app/web-portal exists:"
        - ls -la app/web-portal/ || echo "ERROR: app/web-portal not found!"
        - echo "Installing dependencies..."
        - |
          if [ -d "app/web-portal" ]; then
            cd app/web-portal
            echo "Changed to: $(pwd)"
            npm ci
          else
            echo "ERROR: app/web-portal directory not found!"
            echo "Current directory: $(pwd)"
            ls -la
            exit 1
          fi
    build:
      commands:
        - echo "Build phase - Current directory:"
        - pwd
        - echo "Checking for app/web-portal:"
        - ls -la app/web-portal/ 2>&1 || echo "Directory listing failed"
        - echo "Building web portal..."
        - |
          if [ -d "app/web-portal" ]; then
            cd app/web-portal
            echo "Changed to: $(pwd)"
            npm run build
          else
            echo "ERROR: app/web-portal directory not found in build phase!"
            echo "Current directory: $(pwd)"
            echo "Contents of current directory:"
            ls -la
            echo "Looking for app directory:"
            ls -la app/ 2>&1 || echo "app/ not found"
            exit 1
          fi
  artifacts:
    baseDirectory: app/web-portal/dist
    files:
      - '**/*'
  cache:
    paths:
      - app/web-portal/node_modules/**/*
